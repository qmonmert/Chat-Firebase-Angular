"use strict";function Run(e,t,i){function n(t){t?(e.isAuthenticated=!0,console.log("User "+t.uid+" is logged in with "+t.provider)):(e.isAuthenticated=!1,console.log("User is logged out"))}e.$on("$stateChangeStart",function(t,n,a,r,o){n.authenticate&&!e.isAuthenticated&&(i.go("home"),t.preventDefault())});var a=new Firebase(t.url_firebase);a.onAuth(n)}function AuthService(e,t){var i=new Firebase(t.url_firebase);return e(i)}function StravaService(e,t){function i(){function i(e){return e.data}function n(e){console.error("XHR Failed for getActivities."+e.data)}return e.get(t.json_path+"activities.json").then(i)["catch"](n)}function n(){function i(e){return e.data}function n(e){console.error("XHR Failed for getAthlete."+e.data)}return e.get(t.json_path+"athlete.json").then(i)["catch"](n)}return{getActivities:i,getAthlete:n}}function Config(e,t,i){i.html5Mode(!0).hashPrefix("!"),t.otherwise("/"),e.state("home",{url:"/",templateUrl:"/views/login.html",controller:"LoginCtrl",controllerAs:"loginCtrl",authenticate:!1}).state("chat",{url:"/chat",templateUrl:"/views/chat.html",controller:"ChatCtrl",controllerAs:"chatCtrl",authenticate:!0}).state("admin",{url:"/admin",templateUrl:"/views/admin.html",controller:"AdminCtrl",controllerAs:"adminCtrl",resolve:{ActivitiesPrepService:["StravaService",function(e){return e.getActivities()}]},authenticate:!1})}function LoginCtrl(e,t){function i(){t.$authWithPassword({email:n.email,password:n.password}).then(function(t){console.log("Login success : "+t),e.go("chat")},function(e){console.error("Login fail : "+e)})}var n=this;n.login=i}function ChatCtrl(e,t,i){function n(){var e=(new Date).getTime();o.messages.$add({user:o.email,pseudo:o.pseudo,text:o.newMessageText,img:o.img,time:e}).then(function(){o.scroll()}),o.newMessageText=""}function a(){$(".panel-body").scrollTop(1e6)}function r(){"quentin.monmert@gmail.com"===o.email?(o.pseudo="Quentin",o.img="img/quentin.jpg"):"thibaudmonmert@gmail.com"===o.email?(o.pseudo="Thibaud",o.img="img/thibaud.jpg"):"gmonmert@gmail.com"===o.email?(o.pseudo="Gautier",o.img="img/gautier.jpg"):(o.pseudo="Unknown",o.img="http://placehold.it/50/55C1E7/fff&amp;text=U")}var o=this,s=new Firebase(i.url_firebase),l=s.getAuth();o.scroll=a,o.messages=e(s),o.email=l.password.email,o.pseudo,o.img,o.addMessage=n,r(),t(function(){o.scroll()},2e3)}function AdminCtrl(e,t){function i(){return[{email:"quentin.monmert@gmail.com",password:"admin",pseudo:"Quentin",img:"img/quentin.jpg"},{email:"thibaudmonmert@gmail.com",password:"pass",pseudo:"Thibaud",img:"img/thibaud.jpg"},{email:"gmonmert@gmail.com",password:"pass",pseudo:"Gautier",img:"img/gautier.jpg"},{email:"user@user.com",password:"password",pseudo:"Unknown",img:"..."}]}function n(){angular.forEach(r.activities,function(e,t){e.distance=e.distance/1e3})}function a(){return e.getAthlete().then(function(e){return r.athlete=e,angular.forEach(r.athlete.shoes,function(e,t){e.distance=e.distance/1e3}),r.athlete})}var r=this;r.users=i(),r.activities=t,r.athlete={},n(),a()}angular.module("ChatFirebaseAngularApp",["firebase","ui.router"]),angular.module("ChatFirebaseAngularApp").constant("Constants",{json_path:"json/",url_firebase:"https://popping-fire-9851.firebaseio.com/data"}),angular.module("ChatFirebaseAngularApp").run(Run),Run.$inject=["$rootScope","Constants","$state"],angular.module("ChatFirebaseAngularApp").factory("AuthService",AuthService),AuthService.$inject=["$firebaseAuth","Constants"],angular.module("ChatFirebaseAngularApp").factory("StravaService",StravaService),StravaService.$inject=["$http","Constants"],angular.module("ChatFirebaseAngularApp").config(Config),Config.$inject=["$stateProvider","$urlRouterProvider","$locationProvider"],angular.module("ChatFirebaseAngularApp").controller("LoginCtrl",LoginCtrl),LoginCtrl.$inject=["$state","AuthService"],angular.module("ChatFirebaseAngularApp").controller("ChatCtrl",ChatCtrl),ChatCtrl.$inject=["$firebaseArray","$timeout","Constants"],angular.module("ChatFirebaseAngularApp").controller("AdminCtrl",AdminCtrl),AdminCtrl.$inject=["StravaService","ActivitiesPrepService"];