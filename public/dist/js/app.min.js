!function(){"use strict";function e(e,t,a){function n(t){t?(e.isAuthenticated=!0,console.log("User "+t.uid+" is logged in with "+t.provider)):(e.isAuthenticated=!1,console.log("User is logged out"))}e.$on("$stateChangeStart",function(t,n,i,r,o){n.authenticate&&!e.isAuthenticated&&(a.go("home"),t.preventDefault())});var i=new Firebase(t.url_firebase);i.onAuth(n)}function t(e,t){var a=new Firebase(t.url_firebase);return e(a)}function a(e,t){function a(){function a(e){return e.data}function n(e){console.error("XHR Failed for getActivities."+e.data)}return e.get(t.json_path+"activities.json").then(a)["catch"](n)}function n(){function a(e){return e.data}function n(e){console.error("XHR Failed for getAthlete."+e.data)}return e.get(t.json_path+"athlete.json").then(a)["catch"](n)}return{getActivities:a,getAthlete:n}}function n(e,t,a){a.html5Mode(!0).hashPrefix("!"),t.otherwise("/"),e.state("home",{url:"/",templateUrl:"/views/login.html",controller:"LoginCtrl",controllerAs:"loginCtrl",authenticate:!1}).state("chat",{url:"/chat",templateUrl:"/views/chat.html",controller:"ChatCtrl",controllerAs:"chatCtrl",authenticate:!0}).state("admin",{url:"/admin",templateUrl:"/views/admin.html",controller:"AdminCtrl",controllerAs:"adminCtrl",resolve:{ActivitiesPrepService:["StravaService",function(e){return e.getActivities()}]},authenticate:!1})}function i(e,t){function a(){t.$authWithPassword({email:n.email,password:n.password}).then(function(t){console.log("Login success : "+t),e.go("chat")},function(e){console.error("Login fail : "+e)})}var n=this;n.login=a}function r(e,t,a){function n(){var e=(new Date).getTime();o.messages.$add({user:o.email,pseudo:o.pseudo,text:o.newMessageText,img:o.img,time:e}).then(function(){o.scroll()}),o.newMessageText=""}function i(){$(".panel-body").scrollTop(1e6)}function r(){"quentin.monmert@gmail.com"===o.email?(o.pseudo="Quentin",o.img="img/quentin.jpg"):"thibaudmonmert@gmail.com"===o.email?(o.pseudo="Thibaud",o.img="img/thibaud.jpg"):"gmonmert@gmail.com"===o.email?(o.pseudo="Gautier",o.img="img/gautier.jpg"):(o.pseudo="Unknown",o.img="http://placehold.it/50/55C1E7/fff&amp;text=U")}var o=this,s=new Firebase(a.url_firebase),u=s.getAuth();o.scroll=i,o.messages=e(s),o.email=u.password.email,o.pseudo="",o.img="",o.addMessage=n,r(),t(function(){o.scroll()},2e3)}function o(e,t){function a(){return[{email:"quentin.monmert@gmail.com",password:"admin",pseudo:"Quentin",img:"img/quentin.jpg"},{email:"thibaudmonmert@gmail.com",password:"pass",pseudo:"Thibaud",img:"img/thibaud.jpg"},{email:"gmonmert@gmail.com",password:"pass",pseudo:"Gautier",img:"img/gautier.jpg"},{email:"user@user.com",password:"password",pseudo:"Unknown",img:"..."}]}function n(){angular.forEach(r.activities,function(e,t){e.distance=e.distance/1e3})}function i(){return e.getAthlete().then(function(e){return r.athlete=e,angular.forEach(r.athlete.shoes,function(e,t){e.distance=e.distance/1e3}),r.athlete})}var r=this;r.users=a(),r.activities=t,r.athlete={},n(),i()}angular.module("ChatFirebaseAngularApp",["firebase","ui.router"]),angular.module("ChatFirebaseAngularApp").constant("Constants",{json_path:"json/",url_firebase:"https://popping-fire-9851.firebaseio.com/data"}),angular.module("ChatFirebaseAngularApp").run(e),e.$inject=["$rootScope","Constants","$state"],angular.module("ChatFirebaseAngularApp").factory("AuthService",t),t.$inject=["$firebaseAuth","Constants"],angular.module("ChatFirebaseAngularApp").factory("StravaService",a),a.$inject=["$http","Constants"],angular.module("ChatFirebaseAngularApp").config(n),n.$inject=["$stateProvider","$urlRouterProvider","$locationProvider"],angular.module("ChatFirebaseAngularApp").controller("LoginCtrl",i),i.$inject=["$state","AuthService"],angular.module("ChatFirebaseAngularApp").controller("ChatCtrl",r),r.$inject=["$firebaseArray","$timeout","Constants"],angular.module("ChatFirebaseAngularApp").controller("AdminCtrl",o),o.$inject=["StravaService","ActivitiesPrepService"]}();